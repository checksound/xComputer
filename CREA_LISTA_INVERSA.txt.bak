; **********************************************************
; FASE 1: Trova la Fine della LISTA1 (Punta a dove va lo 0)
; **********************************************************

    lod-c LISTA1 ; Carica l'indirizzo di inizio lista 
    sto P_ORIG_R ; P_ORIG_R (Puntatore Originale, R come Read/Lettura)
    
trova_fine:
    lod-i P_ORIG_R ; Carica il valore della cella puntata
    jmz prepara_copia ; Se il valore è 0, abbiamo trovato la fine (il puntatore è già posizionato sullo 0)
    
    lod P_ORIG_R ; Altrimenti, incrementa il puntatore
    inc
    sto P_ORIG_R
    jmp trova_fine

; A questo punto, P_ORIG_R punta alla cella che contiene il valore 0.

; **********************************************************
; FASE 2: Prepara i Puntatori per la Copia Inversa
; **********************************************************
prepara_copia:
    
    ; 1. P_ORIG_W (Puntatore Originale, W come Write/Scrittura)
    ; Deve puntare all'ULTIMO ELEMENTO VALIDO della LISTA1
    lod P_ORIG_R ; Parte da dove c'è lo 0
    dec          ; Decrementa: ora punta all'ultimo elemento valido (es. 91)
    sto P_ORIG_W ;
    
    ; 2. P_NUOVA_R (Puntatore Nuova Lista, R come Read/Lettura)
    ; Inizializza il puntatore della lista di destinazione
    lod-c START_LISTA2
    sto P_NUOVA_R
    
; **********************************************************
; FASE 3: Copia gli Elementi in Ordine Inverso
; **********************************************************
copia_inversa:

    ; 1. Verifica se abbiamo superato l'inizio della LISTA1
    ; L'indirizzo di P_ORIG_W è minore dell'indirizzo di LISTA1?
    lod-c LISTA1
    sub P_ORIG_W ; AC = LISTA1 - P_ORIG_W
    jmn copia_elemento ; Se il risultato è negativo (P_ORIG_W > LISTA1), copia l'elemento
    
    jmz copia_elemento ; Se il risultato è zezo (P_ORIG_W == LISTA1), copia l'elemento
    
    ; Altrimenti, P_ORIG_W ha raggiunto o superato l'inizio della lista.
    jmp fine_ciclo ; Termina il ciclo

copia_elemento:
    ; 2. Copia il valore
    lod-i P_ORIG_W ; Carica l'elemento puntato dall'originale (es. 91)
    sto-i P_NUOVA_R ; Scrivilo nella nuova lista
    
    ; 3. Aggiorna i puntatori
    
    ; Decrementa P_ORIG_W (passa all'elemento precedente)
    lod P_ORIG_W
    dec
    sto P_ORIG_W
    
    ; Incrementa P_NUOVA_R (passa alla cella successiva nella lista di destinazione)
    lod P_NUOVA_R
    inc
    sto P_NUOVA_R
    
    jmp copia_inversa ; Ripeti il ciclo

; **********************************************************
; FASE 4: Termina il Programma e Aggiunge lo 0 Finale
; **********************************************************
fine_ciclo:

    ; Aggiunge lo 0 finale alla LISTA2 (dove punta P_NUOVA_R)
    lod-c 0
    sto-i P_NUOVA_R

    hlt ; Fine del programma

; **********************************************************
; Dati e Variabili
; **********************************************************
P_ORIG_R: data ; Indirizzo: Puntatore alla LISTA1 (usato per trovare lo 0)
P_ORIG_W: data ; Indirizzo: Puntatore alla LISTA1 (usato per leggere all'indietro)
P_NUOVA_R: data ; Indirizzo: Puntatore alla LISTA2 (usato per scrivere)

; Inizio della lista originale
LISTA1: 8
        9
        3
        21
        17
        6
        2
        91
        0 ; Sentinella (fine lista)

; Inizio della lista di destinazione
START_LISTA2: data ; Qui verrà scritta la lista invertita